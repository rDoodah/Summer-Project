{% extends "base.html" %}

{% block content %}
<div class="container mt-4">
    <h2 class="text-3xl text-blue-700 mb-4">Learner Reports</h2>

    {% if learners %}
        {% for learner in learners %}
        <div class="card mb-4 shadow-sm border-info">
            <div class="card-header bg-primary text-white">
                <h3>{{ learner.name }} (Grade {{ learner.current_grade }})</h3>
            </div>
            <div class="card-body">
                <p><strong>Age:</strong> {{ learner.age }} | <strong>Gender:</strong> {{ learner.gender }} | <strong>Emergency Contact:</strong> {{ learner.emergency_contact }}</p>

                <h5 class="mt-3">Lesson Summary</h5>
                {% if learner.bookings %}
                <div class="table-responsive">
                    <table class="table table-striped table-bordered align-middle">
                        <thead class="table-info">
                            <tr>
                                <th>Date</th>
                                <th>Day</th>
                                <th>Time Slot</th>
                                <th>Grade Level</th>
                                <th>Coach</th>
                                <th>Status</th>
                            </tr>
                        </thead>
                        <tbody>
                            {% for booking in learner.bookings %}
                            <tr>
                                <td>{{ booking.lesson.date }}</td>
                                <td>{{ booking.lesson.day_of_week }}</td>
                                <td>{{ booking.lesson.time_slot }}</td>
                                <td>{{ booking.lesson.grade_level }}</td>
                                <td>{{ booking.lesson.coach.name }}</td>
                                <td>
                                    {% if booking.status == 'booked' %}
                                        <span class="badge bg-warning text-dark">Booked</span>
                                    {% elif booking.status == 'attended' %}
                                        <span class="badge bg-success">Attended</span>
                                    {% elif booking.status == 'cancelled' %}
                                        <span class="badge bg-danger">Cancelled</span>
                                    {% endif %}
                                </td>
                            </tr>
                            {% endfor %}
                        </tbody>
                    </table>
                </div>
                {% else %}
                    <p>No bookings for this learner.</p>
                {% endif %}

                <div class="mt-3">
                    <span class="badge bg-warning text-dark">Total Booked: {{ learner.bookings|selectattr('status', 'equalto', 'booked')|list|length }}</span>
                    <span class="badge bg-success">Total Attended: {{ learner.bookings|selectattr('status', 'equalto', 'attended')|list|length }}</span>
                    <span class="badge bg-danger">Total Cancelled: {{ learner.bookings|selectattr('status', 'equalto', 'cancelled')|list|length }}</span>
                </div>
            </div>
        </div>
        {% endfor %}
    {% else %}
        <p class="text-blue-700">No learners found.</p>
    {% endif %}
</div>
{% endblock %}
